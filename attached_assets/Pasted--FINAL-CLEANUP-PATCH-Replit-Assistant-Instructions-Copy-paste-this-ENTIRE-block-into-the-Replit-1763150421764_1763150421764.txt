âœ… FINAL CLEANUP PATCH â€” Replit Assistant Instructions

(Copy/paste this ENTIRE block into the Replit Assistant)

TITLE: Final Cleanup Patch â€” Ingredient Normalization Fixes

TASK:
Apply these 5 mandatory cleanup fixes to the shopping normalization pipeline.

1ï¸âƒ£ Update canonicalName() in â†’ server/services/shopping-list/normalizer.ts

Add the following rules:

Plural â†’ singular normalization
- "egg whites" â†’ "egg white"
- "eggs" â†’ "egg"
- "berries" â†’ "berry"
- "mixed berries" â†’ "berry"

Descriptor stripping

Ensure canonicalName removes:

grilled

cooked

fresh

chopped

halved

sliced

optional

small/medium/large
(leave them to notes)

Ingredient alias mapping

Add:

if (clean === "egg whites" || clean === "egg white") clean = "egg white";
if (clean === "eggs" || clean === "egg") clean = "egg";

if (clean === "berries" || clean === "berry") clean = "berry";
if (clean === "mixed berries") clean = "berry";

Finalize casing

Return Title Case name (e.g., â€œEgg whiteâ€, â€œBerryâ€).

2ï¸âƒ£ Update unitConverter.ts â†’ FORCE lowercase units

At the top of the converter, add:

unit = unit.toLowerCase();


This ensures:

oz â†’ oz

g â†’ g

cup â†’ cup

tsp â†’ tsp

tbsp â†’ tbsp
(all consistent)

3ï¸âƒ£ Update builder-v2.ts to merge singular/plural forms

Before merging, apply:

name = canonicalName(name);
unit = unit.toLowerCase();


This ensures:

"Egg whites" + "egg white" â†’ ONE item

"Berries" + "Mixed berries" â†’ ONE item

4ï¸âƒ£ Update athleteIngredientMapper.ts

Strip descriptors like â€œgrilledâ€, â€œbakedâ€, â€œleanâ€, â€œfreshâ€, and push them into notes.
Ensure athlete chicken always maps to normalized:

name: "Chicken breast"

5ï¸âƒ£ OPTIONAL: Normalize Tomato units (slice â†’ cup)

(Assistant can skip if conversion is complex)

Add:

if (name === "Tomato" && unit === "slice") {
   // avocado slice ~0.25 oz â†’ ~0.03 cup each; tomatoes ~0.1 cup each
   quantity = quantity * 0.1;
   unit = "cup";
}


This merges:

Tomato 0.5 cup

Tomato 2 slices (~0.2 cup)
â†’ ONE tomato entry

If this feels too aggressive, skip â€” but itâ€™s safe.

SUCCESS CRITERIA

After this patch, the following MUST be true:

Eggs:

Egg whites (1 each)
Egg white (2 each)
Egg (0.5 each)
â†’ All merged into ONE line:

Egg white â€” 3.5 each

Berries:

mixed berries

berries

berry
â†’ ONE line:

Berry â€” total cups

Units:

No uppercase units ever.

Tomato (optional):

Cup + slice conversion â†’ unified.

ğŸ“Œ END OF INSTRUCTIONS