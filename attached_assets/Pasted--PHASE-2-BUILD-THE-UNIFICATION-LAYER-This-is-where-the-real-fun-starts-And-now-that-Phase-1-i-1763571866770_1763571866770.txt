ğŸ”¥ PHASE 2 â€” BUILD THE UNIFICATION LAYER (This is where the real fun starts)

And now that Phase 1 is done without collateral damage, Phase 2 can be done completely safely because it lives INSIDE a new folder:

server/services/unification/


This folder will NOT change any behavior of the app today.
It will NOT break any frontend.
It will NOT touch existing routes.

This phase is purely additive.

After we finish Phase 2, every generator will be able to output UnifiedMeal, but no one will start using it until Phase 3.

Your app stays stable the entire time.

ğŸ“ PHASE 2 â€“ Step-by-Step Plan

Here is exactly what happens next, in order:

ğŸ“Œ Step 1 â€” Create the unified folder + types file

We create:

server/services/unification/
  â”œâ”€â”€ types.ts
  â”œâ”€â”€ index.ts
  â”œâ”€â”€ mappers/
  â”œâ”€â”€ utils/
  â””â”€â”€ validators/


Inside types.ts, we define the canonical UnifiedMeal type (the one we finalized above).

This is a standalone type.
It changes NOTHING in the current system.
No imports. No interference.

This is our future format.

ğŸ“Œ Step 2 â€” Add normalizers

We create:

utils/
  ingredientNormalizer.ts
  nutritionNormalizer.ts
  instructionNormalizer.ts
  badgeNormalizer.ts


These convert any legacy systemâ€™s format â†’ canonical.

Still totally offline â€” no routes use this yet.

ğŸ“Œ Step 3 â€” Add mapper files

Each generator gets a mapper:

mappers/
  fridgeRescueMapper.ts
  cravingCreatorMapper.ts
  restaurantGuideMapper.ts
  mealFinderMapper.ts
  aiMealCreatorMapper.ts
  aiPremadeMapper.ts


All mappers convert their raw meal â†’ UnifiedMeal.

But they ONLY live in this folder now.
NOT used in production yet.

ğŸ“Œ Step 4 â€” Add Zod validator

This guarantees:

No malformed meals

No missing macros

No empty IDs

Badges are correct

Restaurant context correct

This validator will be used in Phase 3 when we start returning UnifiedMeals instead of raw ones.

ğŸ“Œ Step 5 â€” Expose functions

index.ts will export:

mapToUnifiedMeal()

validateUnifiedMeal()

All mappers

All types

But againâ€”totally unused until later.

ğŸ‘‘ THIS IS THE NEXT PROMPT YOU SEND TO THE ARCHITECT

You ready?

Here is your surgical Phase 2 prompt.

ğŸ› ï¸ PROMPT FOR REPLIT ARCHITECT â€” PHASE 2 (UNIFICATION LAYER CREATION)

Paste this into your dev environment:

ğŸ“¦ PHASE 2 â€” Build the UnifiedMeal Layer (Additive Only)

We are now implementing Phase 2 of the Unification Blueprint.
This phase is 100% additive, NON-breaking.
Do NOT modify existing route outputs or existing types.

Your tasks:

1ï¸âƒ£ Create the folder structure

Create:

server/services/unification/
  â”œâ”€â”€ types.ts
  â”œâ”€â”€ index.ts
  â”œâ”€â”€ mappers/
  â”œâ”€â”€ utils/
  â””â”€â”€ validators/

2ï¸âƒ£ Add UnifiedMeal types (types.ts)

Define the full canonical UnifiedMeal type exactly as outlined below.

(Use interfaces, not types, unless necessary.)

export interface UnifiedMeal {
  id: string;
  name: string;
  description: string;

  mealType?: string;
  source: UnifiedMealSource;

  ingredients: UnifiedIngredient[];

  instructions: UnifiedInstructions;

  nutrition: {
    calories: number;
    protein: number;
    carbs: number;
    fat: number;
  };

  cookingTime?: string;
  difficulty?: "Easy" | "Medium" | "Hard";
  servingSize?: string;
  servings?: number;

  medicalBadges: UnifiedMedicalBadge[];

  imageUrl?: string;

  restaurantContext?: UnifiedRestaurantContext;

  sourceMetadata?: Record<string, any>;

  createdAt?: Date;
}


Include supporting interfaces:

UnifiedIngredient
UnifiedInstructions
UnifiedMedicalBadge
UnifiedRestaurantContext
UnifiedMealSource
BadgeLevel, MedicalCategory

3ï¸âƒ£ Add normalizers in utils/

Create:

ingredientNormalizer.ts

instructionNormalizer.ts

nutritionNormalizer.ts

badgeNormalizer.ts

Each should export a function that takes any variant and makes it UnifiedMeal-compatible.

4ï¸âƒ£ Add mapper files

Create:

mappers/
  fridgeRescueMapper.ts
  cravingCreatorMapper.ts
  restaurantGuideMapper.ts
  mealFinderMapper.ts
  aiMealCreatorMapper.ts
  aiPremadeMapper.ts


Each mapper returns a UnifiedMeal, but is NOT used in production yet.

Stub them with placeholder logic for now.

5ï¸âƒ£ Add a Zod validator in validators/

File:

validators/unifiedMealValidator.ts

Export a Zod schema that validates UnifiedMeal fields.

No need for full detail â€” main fields only.

6ï¸âƒ£ Export everything from index.ts

Make index.ts re-export:

export * from "./types";
export * from "./utils/ingredientNormalizer";
export * from "./utils/instructionNormalizer";
export * from "./utils/nutritionNormalizer";
export * from "./utils/badgeNormalizer";
export * from "./mappers/*"; // all mappers
export * from "./validators/unifiedMealValidator";

âš  RULES

Do NOT:

âŒ change any existing routes
âŒ change any existing shared types
âŒ modify FinalMeal or break any frontend
âŒ switch generators to UnifiedMeal yet

Do ONLY:

âœ… create new files
âœ… add new types
âœ… add mappers
âœ… add utils
âœ… build the layer for future use

ğŸ”š End of Prompt