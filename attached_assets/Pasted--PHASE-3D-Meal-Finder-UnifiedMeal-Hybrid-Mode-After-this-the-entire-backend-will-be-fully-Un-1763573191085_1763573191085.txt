üöÄ PHASE 3D ‚Äì Meal Finder ‚Üí UnifiedMeal Hybrid Mode

After this, the entire backend will be fully UnifiedMeal-capable.

The frontend will still be on legacy for now, but the backend will be 100% unified and ready for Phase 4.

üõ†Ô∏è PROMPT FOR REPLIT ARCHITECT ‚Äî PHASE 3D (MEAL FINDER HYBRID)

Paste this into your dev/architect chat:

üöÄ PHASE 3D ‚Äî Enable UnifiedMeal HYBRID response for Meal Finder (/api/meal-finder)

We are completing Phase 3 of the UnifiedMeal migration.

Rules (unchanged):

DO NOT modify or remove legacy fields

DO NOT change existing consumer behavior

DO NOT reorganize RestaurantResult, MealResult, or legacy meal fields

Only ADD new standardized fields: unifiedMeal and unifiedMeals

Use the unification layer mappers + validator

If a UnifiedMeal fails validation, log it and continue

1Ô∏è‚É£ HYBRID TARGET FORMAT

Current legacy response:

{
  "success": true,
  "query": "...",
  "zipCode": "...",
  "results": [ ... ],
  "message": "..."
}


NEW hybrid response:

{
  "success": true,
  "query": "...",
  "zipCode": "...",
  "results": [ ... ],       // legacy unchanged
  "unifiedMeals": [ ... ],  // NEW: UnifiedMeal[]
  "message": "..."
}

2Ô∏è‚É£ Import unification tools

At the top of server/services/mealFinderService.ts or wherever Meal Finder route is handled:

import {
  UnifiedMeal,
  validateUnifiedMeal
} from "../services/unification";

import { mapMealFinderResult } from "../services/unification/mappers/mealFinderMapper";


(Adjust import paths as needed based on your actual folder structure.)

3Ô∏è‚É£ Generate unifiedMeals from results

In the Meal Finder service or directly in the route handler:

const unifiedMeals: UnifiedMeal[] = [];

for (const result of results) {
  try {
    const unified = mapMealFinderResult(result);
    validateUnifiedMeal(unified);
    unifiedMeals.push(unified);
  } catch (err) {
    console.warn("[UnifiedMeal][MealFinder] Validation failed:", err);
  }
}


Remember:

Each result contains one meal, so the mapper returns one UnifiedMeal per RestaurantResult.

If a UnifiedMeal fails validation, do not break the request.

4Ô∏è‚É£ Modify route output (non-breaking)

Where the route currently returns:

return res.json({
  success: true,
  query,
  zipCode,
  results,
  message
});


Modify it to:

return res.json({
  success: true,
  query,
  zipCode,
  results,        // legacy preserved
  unifiedMeals,   // NEW FIELD
  message
});


‚ö† Do NOT remove results.
‚ö† Do NOT rename or restructure anything in results.

Frontend must remain untouched.

5Ô∏è‚É£ Acceptance Criteria

Migration is complete when:

/api/meal-finder still returns exact same legacy output

The response also includes:

"unifiedMeals": [ ...UnifiedMeal objects... ]


Every UnifiedMeal passes Zod validation OR logs a warning

No TypeScript errors

No frontend components break or change behavior

All 3 backend systems are now hybridized:

System	UnifiedMeal Active?
Fridge Rescue	‚úÖ
AI Meal Creator	‚úÖ (shares backend)
AI Premades	‚úÖ (shares backend)
Craving Creator	‚úÖ
Restaurant Guide	‚úÖ
Meal Finder	üîú after this update
End of Prompt