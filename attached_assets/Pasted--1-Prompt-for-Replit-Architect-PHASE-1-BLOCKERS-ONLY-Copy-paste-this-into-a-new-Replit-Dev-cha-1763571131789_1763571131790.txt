üß≤ 1) Prompt for Replit Architect ‚Äì PHASE 1 BLOCKERS ONLY

Copy‚Äìpaste this into a new Replit/Dev chat:

üõ†Ô∏è PROMPT: Phase 1 Unification Blockers ‚Äì Implement Fixes

We‚Äôre beginning Phase 1 of the UnifiedMeal system.
Do NOT try to build the entire unification layer yet.
Right now you are ONLY fixing the four core blockers so the data is consistent.

‚úÖ GLOBAL RULES

Don‚Äôt change any routes‚Äô response shape yet.

Don‚Äôt touch frontend meal cards, WeeklyMealBoard, or routing.

Don‚Äôt introduce new folders for the unification layer yet.

Keep changes surgical, in the specific files listed.

1Ô∏è‚É£ Craving Creator ‚Äì Flatten Nutrition

File: server/services/stableMealGenerator.ts
Goal: Stop returning nested nutrition: { ... } and instead return flat macros at the top level of the meal object.

Current shape (approx):

const meal: CravingCreatorMeal = {
  id,
  name,
  description,
  // ...
  nutrition: {
    calories,
    protein,
    carbs,
    fat,
  },
  // ...
};


üîß Change it so the returned meal object looks like:

const meal: CravingCreatorMeal = {
  id,
  name,
  description,
  // ...
  calories,
  protein,
  carbs,
  fat,
  nutrition: {
    calories,
    protein,
    carbs,
    fat,
  },
  // ...
};


Requirements:

Keep nutrition nested for backward compatibility if other code uses it, but also add the flat fields calories, protein, carbs, fat at the top level.

Make sure all Craving Creator routes (/api/craving-creator/generate, /api/meals/craving-creator, /api/generate-craving-meal) are returning this augmented object.

2Ô∏è‚É£ Craving Creator ‚Äì Fix Medical Badges (strings ‚Üí objects)

In the same file: server/services/stableMealGenerator.ts

Currently, medicalBadgesFor(...) returns a string[] of labels.
We need it to return rich badge objects, like the other systems.

Target shape:

interface UnifiedMedicalBadge {
  id: string;
  label: string;
  level: "green" | "yellow" | "red";
  reason: string;
  category?: "metabolic" | "digestive" | "cardiovascular" | "allergies" | "fitness" | "dietary";
}


üîß Do this:

Change medicalBadgesFor(...) so it returns UnifiedMedicalBadge[] instead of string[].

Map existing badge labels into objects. Example:

// Example mapping rule ‚Äì adjust as needed
function makeBadge(label: string, opts?: { category?: string; level?: "green" | "yellow" | "red"; reason?: string }): UnifiedMedicalBadge {
  return {
    id: `craving-${label.toLowerCase().replace(/\s+/g, "-")}`,
    label,
    level: opts?.level ?? "green",
    reason: opts?.reason ?? `Compatible with ${label.toLowerCase()}`,
    category: opts?.category as any,
  };
}


Update wherever medicalBadgesFor(...) is used so the meal object gets:

medicalBadges: UnifiedMedicalBadge[];


Make sure no Craving Creator path returns string[] for medicalBadges anymore.

3Ô∏è‚É£ Find Meals Near Me ‚Äì Add Unique Meal IDs

File: server/services/mealFinderService.ts

Right now RestaurantResult.meal has no id.
We need a stable id on each meal object for saving/tracking.

Target shape:

interface RestaurantResult {
  restaurantName: string;
  cuisine: string;
  address: string;
  rating?: number;
  photoUrl?: string;
  meal: {
    id: string;   // <-- add this
    name: string;
    description: string;
    calories: number;
    protein: number;
    carbs: number;
    fat: number;
    reason: string;
    modifications: string;
    ingredients: string[];
    imageUrl?: string;
  };
  medicalBadges?: Array<{
    condition: string;
    compatible: boolean;
    reason: string;
    color: string;
  }>;
}


üîß Do this:

When building each RestaurantResult, generate a unique ID, e.g.:

const mealId = `meal-finder-${restaurant.place_id}-${index}`;


Attach that to meal.id.

Make sure this field is included in the response returned by /api/meal-finder.

Do not change any frontend code yet; just make sure the API is now returning meal.id.

4Ô∏è‚É£ AI Premades ‚Äì Stop Nesting Nutrition on Frontend

File: client/src/components/pickers/MealPremadePicker.tsx

Right now we build premadeMeal like this (approx):

const premadeMeal = {
  // ...
  nutrition: generatedMeal.nutrition || {
    calories: generatedMeal.calories || 350,
    protein: generatedMeal.protein || 30,
    carbs: generatedMeal.carbs || 20,
    fat: generatedMeal.fat || 15,
  },
  // ...
};


This creates a nested nutrition object and mixes flat + nested styles.

üîß We need to:

Keep macros flat on the premade meal object: calories, protein, carbs, fat.

If you want to keep nutrition as well for backward compatibility, you can mirror it, but the flat fields must exist.

Change to something like:

const calories = generatedMeal.calories ?? generatedMeal.nutrition?.calories ?? 350;
const protein = generatedMeal.protein ?? generatedMeal.nutrition?.protein ?? 30;
const carbs   = generatedMeal.carbs   ?? generatedMeal.nutrition?.carbs   ?? 20;
const fat     = generatedMeal.fat     ?? generatedMeal.nutrition?.fat     ?? 15;

const premadeMeal = {
  // ...
  calories,
  protein,
  carbs,
  fat,
  // Optional: keep nested for now if needed
  nutrition: {
    calories,
    protein,
    carbs,
    fat,
  },
  // ...
};


Requirements:

After this change, premade meals must expose flat macros (calories, protein, carbs, fat) like Fridge Rescue and Restaurant Guide.

Do not change any parent components or meal board logic yet.

‚úÖ Acceptance Criteria for Phase 1

Before you touch the unification layer:

Craving Creator responses:

Have flat calories/protein/carbs/fat fields.

Have medicalBadges as objects, not strings.

/api/meal-finder responses:

Each meal has a stable id: string.

AI Premades:

premadeMeal objects expose flat macros.

Nested nutrition (if kept) is just a mirror, not a divergence.

Only after these four are done and tested do we move to Phase 2 (building the unification/ folder and UnifiedMeal types).

End of prompt.
üß± Step 2 ‚Äì What YOU do after you paste that

Drop that prompt into the Replit architect/agent.

Let it run changes.

Test four things in the app (or with Postman/Thunder Client):

Craving Creator: inspect API response ‚Üí confirm flat macros + badge objects.

/api/meal-finder: confirm each meal now has id.

Trigger an AI Premade meal ‚Üí inspect the object ‚Üí confirm calories, protein, carbs, fat exist at top level.

Make sure nothing visually broke in those UIs.

Once those are green, you tell me:

‚ÄúPhase 1 blockers done.‚Äù