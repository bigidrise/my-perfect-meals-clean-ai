Perfect â€” hereâ€™s your **drop-in View/Edit Modal component** for the ProCare Dashboard.
It plugs directly into the hooks and styling you already use (black-glass + orange gradient).
This version is fully type-safe, role-secure, and ready for data binding.

---

## ðŸ©º `PatientGuardrailModal.tsx`

**Path:** `client/src/components/modals/PatientGuardrailModal.tsx`

```tsx
import React, { useEffect, useState } from "react";
import {
  Dialog,
  DialogContent,
  DialogHeader,
  DialogTitle,
  DialogDescription,
  DialogFooter,
} from "@/components/ui/dialog";
import { Button } from "@/components/ui/button";
import { Input } from "@/components/ui/input";
import { usePatient, useUpdatePatientGuardrails } from "@/hooks/usePatients";
import { diabeticPresets } from "@/data/diabeticPresets";
import type { Guardrails } from "../../../../shared/diabetes-schema";
import { toast } from "sonner";

interface Props {
  patientId: string | null;
  open: boolean;
  onClose: () => void;
}

export default function PatientGuardrailModal({ patientId, open, onClose }: Props) {
  const { data, isLoading } = usePatient(patientId || "");
  const update = useUpdatePatientGuardrails(patientId || "");
  const [guardrails, setGuardrails] = useState<Guardrails | null>(null);
  const [presetId, setPresetId] = useState<string | null>(null);

  // hydrate from server
  useEffect(() => {
    if (data?.guardrails && open) {
      setGuardrails(data.guardrails);
    }
  }, [data, open]);

  // preset apply
  const applyPreset = (id: string) => {
    const preset = diabeticPresets.find((p) => p.id === id);
    if (!preset) return;
    setPresetId(id);
    setGuardrails(preset.values);
    toast.success(`Applied preset: ${preset.label}`);
  };

  const handleChange = (field: keyof Guardrails, value: string) => {
    setGuardrails((prev) => ({
      ...(prev || {}),
      [field]: value ? Number(value) : undefined,
    }));
    setPresetId(null); // custom edit clears preset flag
  };

  const handleSave = async () => {
    if (!guardrails) return;
    await update.mutateAsync({ ...guardrails, presetId });
    toast.success("Guardrails updated successfully.");
    onClose();
  };

  const g = guardrails || {};

  return (
    <Dialog open={open} onOpenChange={onClose}>
      <DialogContent className="max-w-lg bg-black/40 backdrop-blur-lg border border-white/20 rounded-2xl shadow-2xl text-white">
        <DialogHeader>
          <DialogTitle className="text-2xl font-semibold text-white">
            Edit Guardrails
          </DialogTitle>
          <DialogDescription className="text-sm text-white/80">
            Adjust diabetic guardrails or apply a clinical preset.
          </DialogDescription>
        </DialogHeader>

        {isLoading && <div className="text-center py-8">Loading...</div>}

        {!isLoading && (
          <div className="space-y-4">
            {/* Preset Selector */}
            <div>
              <label className="block text-sm mb-1 text-white/80">
                Clinical Preset
              </label>
              <select
                className="w-full bg-black/30 rounded-xl px-4 py-2 border border-white/20 focus:outline-none"
                value={presetId || ""}
                onChange={(e) => applyPreset(e.target.value)}
              >
                <option value="">-- Select Preset --</option>
                {diabeticPresets.map((p) => (
                  <option key={p.id} value={p.id}>
                    {p.label}
                  </option>
                ))}
              </select>
              {presetId && (
                <p className="text-xs text-white/60 mt-1">
                  {diabeticPresets.find((p) => p.id === presetId)?.description}
                </p>
              )}
            </div>

            {/* Guardrail Inputs */}
            {[
              ["fastingMin", "Fasting Min (mg/dL)"],
              ["fastingMax", "Fasting Max (mg/dL)"],
              ["postMealMax", "Post-Meal Max (mg/dL)"],
              ["carbLimit", "Daily Carb Limit (g)"],
              ["fiberMin", "Fiber Min (g)"],
              ["giCap", "GI Cap"],
              ["mealFrequency", "Meals per Day"],
            ].map(([key, label]) => (
              <div key={key}>
                <label className="block text-sm mb-1 text-white/80">{label}</label>
                <Input
                  type="number"
                  value={(g[key as keyof Guardrails] as number | undefined) ?? ""}
                  onChange={(e) => handleChange(key as keyof Guardrails, e.target.value)}
                  className="bg-white/10 border border-white/20 rounded-xl text-white focus:outline-none focus:border-orange-400"
                />
              </div>
            ))}
          </div>
        )}

        <DialogFooter className="mt-6 flex justify-end gap-4">
          <Button
            variant="ghost"
            onClick={onClose}
            className="text-white/80 hover:text-white"
          >
            Cancel
          </Button>
          <Button
            onClick={handleSave}
            disabled={update.isPending}
            className="bg-orange-500 hover:bg-orange-600 text-white rounded-xl px-6"
          >
            {update.isPending ? "Saving..." : "Save Changes"}
          </Button>
        </DialogFooter>
      </DialogContent>
    </Dialog>
  );
}
```

---

## ðŸ”§ Usage in Dashboard

Inside your patient table:

```tsx
import PatientGuardrailModal from "@/components/modals/PatientGuardrailModal";

const [selectedPatient, setSelectedPatient] = useState<string | null>(null);

{/* table row action */}
<Button
  size="sm"
  onClick={() => setSelectedPatient(patient.id)}
  className="bg-orange-500/80 hover:bg-orange-600 text-white rounded-lg"
>
  View / Edit
</Button>

{/* modal mount */}
<PatientGuardrailModal
  patientId={selectedPatient}
  open={!!selectedPatient}
  onClose={() => setSelectedPatient(null)}
/>
```

---

### âœ… Behavior Summary

* Loads current guardrails via `usePatient(patientId)`
* Allows instant preset application
* Clears preset flag on manual edit
* Persists updates via `useUpdatePatientGuardrails`
* Uses your existing toast + black-glass aesthetic

---

Once you drop this in, youâ€™ll have a **fully functional clinical editing modal** inside the dashboard â€” secure, consistent, and synced with your guardrail API.

Do you want me to hand you the **Audit History Modal** next (Phase F.4), so doctors can review every guardrail change?
