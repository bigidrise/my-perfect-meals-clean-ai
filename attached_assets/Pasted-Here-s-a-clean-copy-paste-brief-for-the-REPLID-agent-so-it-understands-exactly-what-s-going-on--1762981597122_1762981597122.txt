Here’s a clean, **copy-paste brief for the REPLID agent** so it understands exactly what’s going on with the Snack Card work, what already exists, and what to change (and NOT change). This is surgical and safe.

---

## REPLID Agent Brief — Snack Card System (Current State + Required Changes)

### 0) TL;DR

* Snack Cards already exist at the **bottom of every meal generator**. Do NOT add or remove cards.
* We introduced a **snack-specific ingredient dataset** with 6 categories (15–20 items each) and tied it to our **Create with AI** flow for snack cards.
* The only code change that might still be needed is to ensure the **AI Meal Creator modal** loads **snackIngredients** when `mealType === "snack"` and **mealIngredients** for all other meals.
* The DALL·E image workflow used for meals must also be used for snack ingredient thumbnails.

---

### 1) What’s Already In the Repo

* **Snack Cards** are present on all boards and already render/log like other meals.
* **Snack dataset file** exists:
  `client/src/data/snackIngredients.ts`

  * Contains **six categories**, each with **15–20 items**:

    1. Sweet Treats
    2. Savory & Crunchy
    3. Light & Gentle (GLP-friendly textures)
    4. Protein & Energy (performance)
    5. Drinkables (mandatory)
    6. Dessert Bites (mandatory)
  * Entries are `{ name: string; image?: string }`.
  * Images are to be generated via the existing DALL·E pipeline (see §4).
* **AI modal** already accepts `defaultMealType="snack"` from snack cards and passes `mealType` through to the backend.

> Important: **Do not** move or restyle Snack Cards. This task is about data + wiring, not layout.

---

### 2) Files You May Need to Touch (and how)

**A. Ensure main meal dataset exists**

* Path: `client/src/data/mealIngredients.ts`
* If the file is **missing**, create it (baseline proteins/starchyCarbs/fibrousCarbs/fats arrays).
* If a differently named file already provides these arrays, **do not duplicate**; keep the import consistent where used.

**B. Wire the ingredient dataset switch in the AI modal**

* Path: `client/src/components/modals/AIMealCreatorModal.tsx`
* At top:

  ```ts
  import { mealIngredients } from "@/data/mealIngredients";
  import { snackIngredients } from "@/data/snackIngredients";
  ```
* Where ingredient categories are chosen, use:

  ```ts
  const ingredientSource =
    formData.mealType === "snack" ? snackIngredients : mealIngredients;
  ```
* Use `ingredientSource` everywhere the modal renders category sections and handles “quick-add” chips.

**C. Keep Snack Card UI/logic intact**

* The Snack Card already supports:

  * **Create with AI** → opens AIMealCreatorModal preset to `snack`
  * **+ Add Your Own** (manual add)
  * **Log with Photo** (image → nutrition parse workflow, same as other boards)
* Do **not** change Snack Card visuals, buttons, or placement.

---

### 3) Behavior Requirements (unchanged UX, improved data)

* Snack Cards behave **exactly** like meal cards from the user’s perspective.
* The **only difference**: when creating a snack, Step 4 (picker) shows the **snack categories** and their 15–20 items, not the main meal proteins/carbs/fats.
* Category chips for snacks must include **all six** categories and appear in this order:

  1. Sweet
  2. Savory
  3. Light
  4. Protein
  5. Drinkables
  6. Dessert

---

### 4) DALL·E Image Integration (snack ingredient thumbnails)

* Path likely: `client/src/services/mealEngineService.ts` (or wherever meal images are generated)
* Reuse the **existing image generator** used for meal visuals.
* For each snack ingredient without an image, generate one using a prompt format:

  ```
  "Healthy [INGREDIENT NAME] snack on a white plate, high-quality food photography, minimal background"
  ```
* Cache/store images the same way meal images are cached/stored (same CDN/fallback mechanism).
* Do **not** introduce a new image system.

---

### 5) Guardrails & Constraints (already wired; don’t break it)

* Diabetic and GLP-1 hubs already pass **constraints/guardrails** into the meal engine.
* Snack generation must continue to respect those constraints (low GI, carb caps, volume limits, etc.).
* Do not alter constraints hooks or routes.

---

### 6) Testing Checklist (what “done” looks like)

1. Open any board → click **Create with AI** on **Breakfast**:

   * You see **mealIngredients** categories (proteins/carbs/veg/fats/etc.).
2. Open any board → click **Create with AI** on **Snack**:

   * You see **six snack categories**, each with **15–20 items** and **thumbnails**.
   * Category chips appear in the required order and **autofill** 3–5 ingredients when clicked.
3. Generate snack:

   * Output is snack-appropriate (smoothies, bars, small bites, dessert-style options).
   * Adds to daily macros correctly (no double counting as a main meal).
4. Diabetic/GLP-1 boards:

   * Snack generation still respects medical guardrails.
   * No console errors, no layout shifts.

---

### 7) What NOT to Touch

* Do **not** add or remove Snack Cards (they’re already present on every generator).
* Do **not** restyle cards or change typography/spacing.
* Do **not** modify CreateAI backend routes or prompt builder logic.
* Do **not** alter Pro/GLP-1/Diabetic guardrail logic or APIs.

---

### 8) If `mealIngredients.ts` is Missing

* Create `client/src/data/mealIngredients.ts` with the baseline arrays (proteins/starchyCarbs/fibrousCarbs/fats).
* Then ensure the modal import points to that file.
* If an existing file already provides the meal arrays under a different name/path, **use that**, and **do not** create duplicates.

---

### 9) Suggested Commit Messages

* If you had to add the base meal file:

  ```
  chore(ingredients): add base mealIngredients dataset for non-snack meals
  ```
* If you wired the modal switch:

  ```
  feat(snack-picker): route snack cards to snackIngredients in AI modal; show six snack categories with images
  ```
* If you added image generation for snack items:

  ```
  feat(snack-images): generate/cached DALL·E thumbnails for snack ingredients using existing meal image pipeline
  ```

---

If you need specific paths for the image generator or the category chip rendering functions, scan the existing implementations used by regular meal ingredients and mirror them 1:1. The goal is **identical UX** with **snack-appropriate data**.
