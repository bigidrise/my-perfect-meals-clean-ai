Perfect â€” this is **exactly** what I needed. That breakdown tells me everything: routing, providers, redirect logic, and the right insertion points.
Now that I see your flow clearly, hereâ€™s the **complete setup plan** for the â€œCoach Mode / Welcome Gateâ€ system â€” and then Iâ€™ll hand you the full React/Tailwind code to drop in.

---

## ğŸ§­ OVERALL PLAN

### ğŸ”¹ Where It Lives

Weâ€™ll integrate this right inside **`AppRouter.tsx`**, since that file already controls redirects and auth gates.

### ğŸ”¹ Flow Overview

1. **App opens** â†’ location is `/`.
2. `AppRouter.tsx` checks:

   * If user has **never chosen** a guide â†’ show `WelcomeGate`.
   * If user has chosen:

     * **Self Mode** â†’ skip directly to `/dashboard`.
     * **Coach Mode** â†’ route to `/dashboard`, then trigger guided flashes.
3. On the first visit:

   * `WelcomeGate.tsx` (black glass screen) appears.
   * Two buttons:
     **ğŸ§­ Self-Guided Mode** or **âœ¨ Intuitive Coach Mode**.
   * Once they pick, we store preference â†’ fade out â†’ continue to Home (`/dashboard`).

---

## ğŸ§© FILES TO ADD / UPDATE

### **1ï¸âƒ£ Create `client/src/components/WelcomeGate.tsx`**

A sleek, black-glass overlay that fades out after the user chooses.

```tsx
import { useState } from "react";
import { motion, AnimatePresence } from "framer-motion";

export default function WelcomeGate({ onComplete }: { onComplete: () => void }) {
  const [fade, setFade] = useState(false);

  const chooseMode = (mode: "guided" | "self") => {
    localStorage.setItem("coachMode", mode);
    setFade(true);
    setTimeout(onComplete, 1000);
  };

  return (
    <AnimatePresence>
      {!fade && (
        <motion.div
          initial={{ opacity: 1 }}
          animate={{ opacity: fade ? 0 : 1 }}
          exit={{ opacity: 0 }}
          transition={{ duration: 1 }}
          className="fixed inset-0 z-[9999] flex items-center justify-center bg-black/70 backdrop-blur-md"
        >
          <div className="text-center space-y-6 px-6 max-w-md">
            <h1 className="text-3xl font-bold text-white">Welcome to My Perfect Meals</h1>
            <p className="text-lg text-white/80">Powered by Emotion AI</p>
            <p className="text-sm text-white/60">
              Choose how you'd like to begin your journey:
            </p>
            <div className="flex flex-col sm:flex-row gap-4 justify-center mt-6">
              <button
                onClick={() => chooseMode("guided")}
                className="w-full sm:w-auto bg-white/10 hover:bg-white/20 text-white px-6 py-3 rounded-xl border border-white/20"
              >
                âœ¨ Intuitive Coach Mode
              </button>
              <button
                onClick={() => chooseMode("self")}
                className="w-full sm:w-auto bg-white/10 hover:bg-white/20 text-white px-6 py-3 rounded-xl border border-white/20"
              >
                ğŸ§­ Self-Guided Mode
              </button>
            </div>
            <p className="text-xs text-white/40 pt-4">
              You can change this anytime in Settings under â€œCoach Mode.â€
            </p>
          </div>
        </motion.div>
      )}
    </AnimatePresence>
  );
}
```

---

### **2ï¸âƒ£ Modify `client/src/components/AppRouter.tsx`**

Insert the WelcomeGate *before* redirects happen.

```tsx
import { useEffect, useState } from "react";
import WelcomeGate from "./WelcomeGate";
import { useLocation, useRouter } from "wouter";

export default function AppRouter({ children }) {
  const [location, setLocation] = useLocation();
  const [showGate, setShowGate] = useState(false);
  const [coachMode, setCoachMode] = useState(() => localStorage.getItem("coachMode"));

  useEffect(() => {
    if (!coachMode) {
      setShowGate(true);
    } else if (location === "/") {
      // If no welcome gate needed, continue to dashboard
      setLocation("/dashboard");
    }
  }, [location, coachMode]);

  if (showGate) {
    return (
      <WelcomeGate
        onComplete={() => {
          setShowGate(false);
          setCoachMode(localStorage.getItem("coachMode"));
          setLocation("/dashboard");
        }}
      />
    );
  }

  return <>{children}</>;
}
```

---

### **3ï¸âƒ£ Guided Flash Trigger (MacroCalculator Button)**

Inside **`DashboardNew.tsx`**, wrap your *Macro Calculator* card/button with a conditional glow if coach mode is on.

```tsx
const coachMode = localStorage.getItem("coachMode") === "guided";
const [flashMacro, setFlashMacro] = useState(coachMode);

useEffect(() => {
  if (coachMode) {
    // Stop flashing after a few seconds or once clicked
    const timer = setTimeout(() => setFlashMacro(false), 8000);
    return () => clearTimeout(timer);
  }
}, []);

<Button
  onClick={() => setLocation("/macro-counter")}
  className={`${flashMacro ? "animate-pulse ring-2 ring-white/60" : ""}`}
/>
```

Later, weâ€™ll build the **`?` guided flow** inside the MacroCounter page (using small animations and highlights per field).

---

## ğŸª„ EXPERIENCE FLOW

1. User opens app â†’ sees **black glass WelcomeGate** (powered by Emotion AI).
2. Chooses:

   * âœ¨ **Intuitive Coach Mode** â†’ sets mode â†’ fade â†’ â€œWelcome Backâ€ screen appears â†’ Macro Calculator flashes.
   * ğŸ§­ **Self-Guided Mode** â†’ skips all cues â†’ goes straight to Home.
3. At any time, they can toggle â€œCoach Modeâ€ inside settings or profile (we can add that easily later).
4. Later pages (Biometrics, Craving Creator, etc.) can reuse the same coachMode flag for blinking walkthroughs.

---

Would you like me to continue next by writing the **guided blinking flow for the Macro Calculator page** (`MacroCounter.tsx`) â€” so when theyâ€™re in Coach Mode, it flashes through each step (Goal â†’ Body Type â†’ Activity â†’ Calculate â†’ Send to Biometrics)?
