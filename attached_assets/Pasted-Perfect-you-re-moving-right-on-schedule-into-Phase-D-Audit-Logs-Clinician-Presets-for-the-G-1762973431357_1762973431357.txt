Perfect ‚Äî you‚Äôre moving right on schedule into **Phase D: Audit Logs + Clinician Presets** for the GLP-1 Hub.

Here‚Äôs how this final functional layer will work, keeping everything aligned with the same clean architecture you already used on the Diabetic Hub.

---

## ‚öôÔ∏è Phase D Goal

Add *visibility* and *speed* for clinicians:

1. Log every time guardrails are changed (who + what + when).
2. Provide ready-made presets for quick setup.

---

### üßæ 1Ô∏è‚É£ Audit Trail Table

**Migration ‚Äî `migrations/0006_create_glp1_audit_log.sql`**

```sql
CREATE TABLE glp1_audit_log (
  id TEXT PRIMARY KEY,
  user_id TEXT NOT NULL,
  clinician_id TEXT,
  action TEXT NOT NULL,           -- e.g. "update_guardrails"
  previous_values JSONB,
  new_values JSONB,
  created_at TIMESTAMPTZ DEFAULT NOW()
);
```

---

### üîç 2Ô∏è‚É£ Server Logging

Inside `server/routes/glp1.ts`, when a `PUT /api/glp1/profile` succeeds:

```ts
await db.insert(glp1AuditLog).values({
  id: crypto.randomUUID(),
  user_id: userId,
  clinician_id: req.user.id,    // or req.user.role === "clinician" ? req.user.id : null
  action: "update_guardrails",
  previous_values: existing?.guardrails ?? null,
  new_values: guardrails,
});
```

This keeps a full change history for compliance or later reporting.

---

### ‚öïÔ∏è 3Ô∏è‚É£ Clinician Preset Library

Create `client/src/data/glp1Presets.ts`:

```ts
export const glp1Presets = [
  {
    id: "intro_titration",
    label: "Intro / Up-Titration",
    description: "Smallest meals, lowest fat ‚Äî early dose stage.",
    values: {
      maxMealVolumeMl: 250, proteinMinG: 25, fatMaxG: 10,
      fiberMinG: 25, hydrationMinMl: 2200, mealsPerDay: 5,
      slowDigestOnly: true, limitCarbonation: true, limitAlcohol: true,
    },
  },
  {
    id: "maintenance",
    label: "Maintenance",
    description: "Stable dose, balanced macros, steady hydration.",
    values: {
      maxMealVolumeMl: 300, proteinMinG: 30, fatMaxG: 15,
      fiberMinG: 28, hydrationMinMl: 2000, mealsPerDay: 4,
      slowDigestOnly: true, limitCarbonation: true, limitAlcohol: true,
    },
  },
  {
    id: "muscle_preserve",
    label: "Refeed / Strength Focus",
    description: "Higher protein for lean-mass preservation.",
    values: {
      maxMealVolumeMl: 350, proteinMinG: 40, fatMaxG: 15,
      fiberMinG: 30, hydrationMinMl: 2500, mealsPerDay: 4,
      slowDigestOnly: true, limitCarbonation: true, limitAlcohol: false,
    },
  },
];
```

---

### üß± 4Ô∏è‚É£ Preset Dropdown UI

In `GLP1Hub.tsx`, insert a dropdown **above the guardrail inputs**:

```tsx
<select
  value={selectedPreset}
  onChange={(e) => {
    const preset = glp1Presets.find(p => p.id === e.target.value);
    if (preset) setGuardrails(preset.values);
    setSelectedPreset(e.target.value);
  }}
  className="w-full rounded-xl bg-black/30 border border-purple-300/30 text-white px-3 py-2 text-sm mb-3"
>
  <option value="">-- Select Preset --</option>
  {glp1Presets.map(p => (
    <option key={p.id} value={p.id}>{p.label}</option>
  ))}
</select>
<p className="text-white/70 text-xs mb-4">
  {selectedPreset && glp1Presets.find(p => p.id === selectedPreset)?.description}
</p>
```

Selecting a preset instantly fills the guardrail fields with those values.

---

### üß™ 5Ô∏è‚É£ Validation Checklist

| Test                  | Expected Result                      |
| --------------------- | ------------------------------------ |
| Choose preset         | Fields auto-populate correctly       |
| Click Save            | ‚úÖ PUT /api/glp1/profile ‚Üí 200 OK     |
| DB ‚Üí glp1_audit_log   | ‚úÖ New row with previous & new values |
| Refresh               | ‚úÖ Fields reload with saved values    |
| Attempt invalid value | ‚ùå 400 Bad Request (Zod validation)   |

---

### üóÇÔ∏è 6Ô∏è‚É£ Commit Message

```
feat(glp1-hub): Phase D ‚Äì add audit logging and clinician preset system
```

---

That closes the functional loop: every GLP-1 profile change is logged and clinicians can apply evidence-based presets instantly.

Would you like me to draft the **Replit agent briefing prompt** for Phase D next, so the assistant can build these routes, migration, and UI elements exactly to spec?
