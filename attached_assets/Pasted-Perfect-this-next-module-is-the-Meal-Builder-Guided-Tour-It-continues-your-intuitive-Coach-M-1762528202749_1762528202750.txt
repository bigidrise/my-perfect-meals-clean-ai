Perfect ‚Äî this next module is the **Meal Builder Guided Tour**.
It continues your intuitive Coach Mode experience right inside each meal board (like Weekly Meal Board, Diabetic Hub, or GLP-1 Hub).

Here‚Äôs exactly what this one does:

---

### üß≠ Flow Recap: ‚ÄúCoach in Your Pocket‚Äù Meal Builder

When the user lands on any *meal board page* (e.g., `/weekly-meal-board`):

1. Coach Mode detects they haven‚Äôt built a meal yet ‚Üí **flashing ‚ÄúCreate AI Meal‚Äù button** appears on the first meal card.
2. When they click it:

   * The **picker drawer** opens.
   * The **question-mark help icon flashes**, and pressing it shows a short overlay:

     > ‚ÄúPick your favorite protein first ‚Äî that one‚Äôs required.
     > Carbs and Fats are optional.
     > You can also type custom foods below.‚Äù
   * Then the **Protein section flashes**, followed by **Carbs ‚Üí Fats ‚Üí Done**.
3. When they press **Done**, the app returns to the board and automatically moves the highlight to the next meal slot (Lunch ‚Üí Dinner ‚Üí Snack).

---

# 1Ô∏è‚É£ Create: `client/src/components/guided/MealBuilderGuidedTour.tsx`

```tsx
import { useEffect, useState } from "react";

/**
 * Meal Builder Guided Tour
 *
 * Adds flashing highlight to the first "Create AI Meal" button.
 * When the picker drawer opens, shows an overlay explaining how to use it.
 * Sequentially flashes Protein ‚Üí Carbs ‚Üí Fats ‚Üí Done buttons.
 */

export default function MealBuilderGuidedTour() {
  const coachMode = localStorage.getItem("coachMode") === "guided";
  const [pickerOpen, setPickerOpen] = useState(false);
  const [step, setStep] = useState<"ai" | "protein" | "carb" | "fat" | "done" | null>(
    coachMode ? "ai" : null
  );
  const [showHelp, setShowHelp] = useState(false);

  useEffect(() => {
    if (!coachMode) return;

    // Detect if picker drawer is opened
    const observer = new MutationObserver(() => {
      const picker = document.getElementById("meal-picker-drawer");
      if (picker && picker.classList.contains("open")) {
        setPickerOpen(true);
        setStep("protein");
      } else {
        setPickerOpen(false);
      }
    });

    observer.observe(document.body, { subtree: true, attributes: true });
    return () => observer.disconnect();
  }, [coachMode]);

  // advance steps manually from UI
  const nextStep = () => {
    if (step === "protein") return setStep("carb");
    if (step === "carb") return setStep("fat");
    if (step === "fat") return setStep("done");
    if (step === "done") return setStep(null);
  };

  if (!coachMode) return null;

  return (
    <>
      {/* Flashing Create AI Meal (when board first opens) */}
      {step === "ai" && (
        <div className="absolute top-2 left-2 z-[40] animate-pulse">
          <button
            onClick={() => setStep("protein")}
            className="bg-emerald-600/90 border border-emerald-300/40 text-white rounded-lg px-4 py-2 flash-green"
          >
            Create AI Meal ‚Üí
          </button>
        </div>
      )}

      {/* When picker is open, show question mark help */}
      {pickerOpen && (
        <>
          <button
            onClick={() => setShowHelp(true)}
            className="fixed top-4 right-4 z-[80] bg-white/10 hover:bg-white/20 text-white rounded-full w-10 h-10 flex items-center justify-center border border-white/20 backdrop-blur-sm flash-white"
            title="How it works"
          >
            ?
          </button>

          {showHelp && <PickerHelpOverlay onClose={() => setShowHelp(false)} />}
        </>
      )}

      {/* Highlight sequence inside picker */}
      {pickerOpen && step && <PickerHighlights step={step} nextStep={nextStep} />}
    </>
  );
}

function PickerHelpOverlay({ onClose }: { onClose: () => void }) {
  return (
    <div className="fixed inset-0 z-[90] bg-black/80 backdrop-blur flex items-center justify-center">
      <div className="bg-black/60 border border-white/15 text-white rounded-3xl shadow-lg p-6 max-w-lg w-[92vw] relative">
        <h2 className="text-xl font-semibold mb-2">Building Your Perfect Meal</h2>
        <p className="text-sm text-white/80 leading-relaxed">
          Pick your <span className="font-semibold text-emerald-300">protein</span> first ‚Äî it‚Äôs
          required. Then choose your favorite carbs and fats if you want. You can
          also type custom foods at the bottom. When finished, press{" "}
          <span className="font-semibold text-emerald-300">Done</span>.
        </p>
        <button
          onClick={onClose}
          className="absolute top-3 right-3 text-white/60 hover:text-white text-lg"
        >
          ‚úï
        </button>
      </div>
    </div>
  );
}

function PickerHighlights({
  step,
  nextStep,
}: {
  step: "protein" | "carb" | "fat" | "done";
  nextStep: () => void;
}) {
  useEffect(() => {
    const idMap = {
      protein: "picker-protein-section",
      carb: "picker-carb-section",
      fat: "picker-fat-section",
      done: "picker-done-btn",
    } as const;

    const el = document.getElementById(idMap[step]);
    if (el) {
      el.classList.add("flash-green-strong");
      return () => el.classList.remove("flash-green-strong");
    }
  }, [step]);

  // automatically progress after 8s if user doesn't click
  useEffect(() => {
    const timer = setTimeout(nextStep, 8000);
    return () => clearTimeout(timer);
  }, [step]);

  return null;
}
```

---

# 2Ô∏è‚É£ Add IDs to your Picker component

In your existing **MealPickerDrawer.tsx** (or equivalent), add these IDs so the tour can highlight the correct elements:

```tsx
<section id="picker-protein-section"> ... </section>
<section id="picker-carb-section"> ... </section>
<section id="picker-fat-section"> ... </section>

<Button id="picker-done-btn" onClick={handleDone}>Done</Button>
```

Also, ensure the drawer root has:

```html
<div id="meal-picker-drawer" className={isOpen ? "open" : ""}>
```

That‚Äôs how the tour detects when it‚Äôs open.

---

# 3Ô∏è‚É£ Import on each Meal Board page

For example, in `client/src/pages/WeeklyMealBoard.tsx`:

```tsx
import MealBuilderGuidedTour from "@/components/guided/MealBuilderGuidedTour";

export default function WeeklyMealBoard() {
  return (
    <div className="relative">
      <MealBuilderGuidedTour />

      {/* existing meal board content */}
      <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
        {/* first meal card example */}
        <div className="relative bg-black/40 rounded-2xl p-4">
          <h3 className="text-white font-semibold mb-2">Meal 1: Breakfast</h3>
          <button
            id="create-ai-meal-btn"
            onClick={openPicker}
            className="btn btn-glass"
          >
            Create AI Meal
          </button>
        </div>
      </div>
    </div>
  );
}
```

---

# 4Ô∏è‚É£ CSS (use the same animations already defined)

You‚Äôve already added:

```css
.flash-green { animation: pulseGreen 1.4s infinite; }
.flash-green-strong { animation: pulseGreen 1.1s infinite; }
.flash-white { animation: pulseWhite 1.5s infinite; }
```

Those cover every flash needed here.

---

‚úÖ **Result**

* When the meal board opens ‚Üí ‚ÄúCreate AI Meal‚Äù button pulses.
* After clicking ‚Üí picker drawer opens.
* Flashing **?** icon shows, user can tap it for quick instructions.
* Then sequential flashes guide them through: Protein ‚Üí Carb ‚Üí Fat ‚Üí Done.
* Pressing **Done** removes highlights and returns to the meal board ready for the next meal.

---

Next up (optional):
We can connect a simple ‚Äúmeal progression tracker‚Äù so the flashing automatically jumps to the next meal slot after saving each one.

Would you like me to go ahead and write that next (the automatic **next-meal progression tracker**)?
